<%@ tag import="java.io.*,java.util.*,org.mitre.mrald.taglib.*,org.mitre.mrald.util.*,java.sql.*" %>
<%
	String person_id = "0";
	Object person= request.getAttribute("person_id");
   if (person != null)
   		person_id = person.toString();
	System.out.println("User " + person_id);
    String query = 
	    "select s.CRI as cri, l.category_value as cat, s.timestamp as tm from"
		+" status_notification n,"
		+" submission s, category_lkup l, request  "
		+" where n.submission_submission_id = s.submission_id and "
		+" request.category_lkup_category_id = l.category_id and " 
		+ " request.request_id = s.request_request_id and "+ 
        " request.saife_user_user_id = ? ";
        
        
    int userId = Integer.parseInt(person_id);    
    Connection conn = new MraldConnection("main").getConnection();
    PreparedStatement prep = conn.prepareStatement(query);
	prep.setInt(1, userId);
    System.out.println("showAlerts.tag: query " + prep.toString());
    
    ResultSet rs =null;
    
    StringBuffer logInfo = new StringBuffer();
    long startTime = MiscUtils.logQuery("showDbs.tag", "main", query, logInfo);
    
    rs = prep.executeQuery();
    MiscUtils.logQueryRun(startTime, logInfo);
    %>
    <style type="text/css"> 
        .RED { color:red; } 
        .GREEN { color:darkgreen; } 
        .YELLOW { color:orange; } 
    </style>
    <table>
        	<tr><th>CRI</th><th>Category</th><th>Time</th></tr>
    <%    	
    while (rs.next())
    {
        String cri = rs.getString("cri");
        String cat = rs.getString("cat");
        String tm = rs.getString("tm");
        %>
        	<tr class="<%=cat%>"><td><a href="#"><%=cri%></a></td><td><%=cat%></td><td><%=tm%></td></tr>
       
        
        <%	
        
    }
    out.write("</table>");
    rs.close();
    conn.close();
%>