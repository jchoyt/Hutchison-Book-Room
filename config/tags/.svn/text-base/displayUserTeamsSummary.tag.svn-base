<%@ tag import="java.io.*,java.util.*,org.mitre.mrald.taglib.*,org.mitre.mrald.util.*,java.sql.*" %>
<%
           
    String person_id = WebUtils.getOptionalParameter(request, "person_id", "0" );
  	int user_id = Integer.parseInt(person_id);
    System.out.println("displayUserTeams.jsp : person_id " + person_id);
    
    String query =  
     "select distinct team_id, team_name from saife_team s, team_user t, saife_user u " 
    + " where s.team_id = t.saife_team_team_id " 
    + " and saife_user_user_id = u.user_id and "
	+"  user_id= ? order by team_name ";
	
    StringBuffer logInfo = new StringBuffer();
    long startTime = MiscUtils.logQuery("displayUserTeams.tag", "main", query, logInfo);
    Connection conn = new MraldConnection("main").getConnection();
    PreparedStatement prep = conn.prepareStatement(query);
	prep.setInt(1, user_id);
	
    ResultSet rs =prep.executeQuery();
    String team_name="";
    
    MiscUtils.logQueryRun(startTime, logInfo);
    ArrayList<String> teamIds = new ArrayList<String>();
    HashMap<String,String> teamNames = new HashMap<String,String>();
    while (rs.next())
    {
    	teamIds.add(rs.getInt(1) + "");
    	teamNames.put(rs.getInt(1) + "", rs.getString("team_name"));    	     
    }
    
    for (String teamId: teamIds)
    {
      
      
      team_name = teamNames.get(teamId);
      %>
    	 <div class="wide_table_top">
					<div align="center">
					<span class="title_panel"><%=team_name%>
					 &nbsp<input type="button" value ="+" onclick="$('#teamMembers<%=teamId%>').load('listTeam.jsp?team_id=<%=teamId%>')"></input>
					</span> 
					</div>
		
		 </div>
		<div id="teamMembers<%=teamId%>">			
		</div>
        <%	
    }
    
    rs.close();
    conn.close();
    %>
    <div class="wide_table_bottom">
	</div>
