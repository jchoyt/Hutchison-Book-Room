<%@ tag import="java.io.*,java.util.*,org.mitre.mrald.taglib.*,org.mitre.mrald.util.*,java.sql.*" %>
<%
    String user = WebUtils.getOptionalParameter(request, "user", "ghamilton" );
     String profileId = WebUtils.getRequiredParameter(request, "profile_id");
     String person_id = WebUtils.getOptionalParameter(request, "person_id", "-1" );
    
    
    String query = 
    "select  saife_user.user_id, user_name, first_name, last_name, by_email, by_fax, by_telephone, by_mobile_phone, by_voice_message, by_text_message, profile_name, profile_id, saife_team_team_id  "
	+" from user_profile, saife_user where saife_user.user_id = user_profile.saife_user_user_id and saife_user.user_id = ? and profile_id = ? ";
    Connection conn = new MraldConnection("main").getConnection();
    
    int profile_id = Integer.parseInt(profileId);
	int user_id = Integer.parseInt(person_id);
	
    PreparedStatement prep = conn.prepareStatement(query);
	prep.setInt(1, user_id);
	prep.setInt(2, profile_id);	
	
	System.out.println("EditUserAlerts : About to execute query " + prep.toString());
    
    StringBuffer logInfo = new StringBuffer();
    long startTime = MiscUtils.logQuery("displayUserAlerts.tag", "main", query, logInfo);
    ResultSet rs =prep.executeQuery();
    
    MiscUtils.logQueryRun(startTime, logInfo);
    %>
    <style type="text/css"> 
        .RED { color:red; } 
        .GREEN { color:darkgreen; } 
        .YELLOW { color:orange; } 
    </style>
   
    <%    	
    boolean foundVal = false;
    while (rs.next())
    {
        foundVal = true;
        String name = rs.getString("user_name");
        String first_name = rs.getString("first_name");
        String last_name = rs.getString("last_name");
        String profile_name = rs.getString("profile_name");
        user_id = rs.getInt("user_id");
    	%>
    	 			<center>
					<table name="Alerts" width="500" border=".1" cellpadding="1"
					cellspacing="1" align="center">
					<br/>
        	
       <% 	
        int by_email = rs.getInt("by_email");
        int by_fax = rs.getInt("by_fax");
        int by_telephone = rs.getInt("by_telephone");
        int by_mobile_phone = rs.getInt("by_mobile_phone");
        int by_voice_message = rs.getInt("by_voice_message");
        int by_text_message = rs.getInt("by_text_message");
        int team_id = rs.getInt("saife_team_team_id"); 
        
        %>
        	<tr class="header">
        	<th>Method / Priority</th><th class="class1">1</th><th class="class2">2</th><th class="class3">3</th><th class="class4">4</th><th class="class5">5</th><th class="class6">6</th></tr>
        	<%
        	    StringBuffer byEmail= new StringBuffer("<td>Email</td>");
        		StringBuffer byPhone= new StringBuffer("<td>Phone</td>");
        		StringBuffer byFax= new StringBuffer("<td>Fax</td>");
        		StringBuffer byMobile= new StringBuffer("<td>Mobile</td>");
        		StringBuffer byVoiceMail= new StringBuffer("<td>Voice Mail</td>");
        		StringBuffer byTextMessage= new StringBuffer("<td>Text Message</td>");
        		
        		for (int i=1; i < 7; i++)
        		{	
        			byEmail.append("<td><input type=\"radio\" name=\"byEmail\" value=\"" + i + "\"" );
        			if ( by_email == i)
        			{
        				byEmail.append( " checked=\"true\" ");
        				
        			}
        			byEmail.append("></td>");
        			
        			byPhone.append("<td><input type=\"radio\" name=\"byPhone\" value=\"" + i + "\"");
        			if ( by_telephone == i)
        			{
        				byPhone.append( " checked=\"true\" ");
        				
        			}
        			byPhone.append("></td>");
        			
        			byFax.append("<td><input type=\"radio\" name=\"byFax\" value=\"" + i + "\"");
        			
        			if ( by_fax == i)
        			{
        				byFax.append( " checked=\"true\" ");
        				
        			}
        			byFax.append("></td>");
        			
        			byMobile.append("<td><input type=\"radio\" name=\"byMobile\" value=\"" + i + "\"");
        			
        			if ( by_mobile_phone == i)
        			{
        				byMobile.append( " checked=\"true\" ");
        				
        			}
        			byMobile.append("></td>");
        			
        			
        			byVoiceMail.append("<td><input type=\"radio\" name=\"byVoiceMail\" value=\"" + i + "\"");
        			
        			if ( by_voice_message == i)
        			{
        				byVoiceMail.append( " checked=\"true\" ");
        				
        			}
        			byVoiceMail.append("></td>");
        			
        			byTextMessage.append("<td><input type=\"radio\" name=\"byTextMessage\" value=\"" + i + "\"");
        			
        			if ( by_text_message == i)
        			{
        				byTextMessage.append( " checked=\"true\" ");
        				
        			}
        			byTextMessage.append("></td>");
        		}
        	%>
        	<input type="hidden" name="newValue" value="false"></input>
        	<input type="hidden" name="profile_id" value="<%=profile_id%>"></input>
        	<input type="hidden" name="user_id" value="<%=user_id%>"></input>
        	<input type="hidden" name="person_id" value="<%=user_id%>"></input>
        	<input type="hidden" name="team_id" value="<%=team_id%>"></input>
        	
        	<tr align="center"><%=byEmail.toString()%></tr>
        	<tr align="center"><%=byPhone.toString()%></tr>
        	<tr align="center"><%=byFax.toString()%></tr>
        	<tr align="center"><%=byMobile.toString()%></tr>
        	<tr align="center"><%=byVoiceMail.toString()%></tr>
        	<tr align="center"><%=byTextMessage.toString()%></tr>
        	
            </table>
            <br/>
           <input type="button" value ="Close" onclick="$('#profileDetails<%=profile_id%>').html('')"></input>
     		<input type="submit" class="button" value="Save" ></input>
			<br/>		
            </center>
          
        <%	
        
    }

    if (!foundVal)
    {
    	  
    	  query = "select  user_id, user_name, first_name, last_name "
						+" from saife_user where  user_id = ?  ";
    	
    	 prep = conn.prepareStatement(query);
		 prep.setInt(1, user_id);
		 rs = prep.executeQuery();
		 //System.out.println("EditUserAlerts : About to execute query " + prep.toString());
          
          String name="";
          String first_name="";
          String last_name ="";
		 if (rs.next())
		 {
		     user_id = rs.getInt("user_id");
			  name = rs.getString("user_name");
        	  first_name = rs.getString("first_name");
              last_name = rs.getString("last_name");
		 }
    %>
   
					<center>
					<table name="Alerts" width="500" border=".1" cellpadding="1"
					cellspacing="1" align="center">
					<br/>
    <tr class="header">
        	<th>Method / Priority</th><th class="class1">1</th><th class="class2">2</th><th class="class3">3</th><th class="class4">4</th><th class="class5">5</th><th class="class6">6</th></tr>
        	<%
        	    StringBuffer byEmail= new StringBuffer("<td>Email</td>");
        		StringBuffer byPhone= new StringBuffer("<td>Phone</td>");
        		StringBuffer byFax= new StringBuffer("<td>Fax</td>");
        		StringBuffer byMobile= new StringBuffer("<td>Mobile</td>");
        		StringBuffer byVoiceMail= new StringBuffer("<td>Voice Mail</td>");
        		StringBuffer byTextMessage= new StringBuffer("<td>Text Message</td>");
        		
        		for (int i=1; i < 7; i++)
        		{	
        			byEmail.append("<td><input type=\"radio\" name=\"byEmail\" value=\"" + i + "\"></td>");        			
        			byPhone.append("<td><input type=\"radio\" name=\"byPhone\" value=\"" + i + "\"></td>");       			
        			byFax.append("<td><input type=\"radio\" name=\"byFax\" value=\"" + i + "\"></td>");        			
        			byMobile.append("<td><input type=\"radio\" name=\"byMobile\" value=\"" + i + "\"></td>");        			       			
        			byVoiceMail.append("<td><input type=\"radio\" name=\"byVoiceMail\" value=\"" + i + "\"></td>");
        			byTextMessage.append("<td><input type=\"radio\" name=\"byTextMessage\" value=\"" + i + "\"></td>");
        		}
        	%>
        	<input type="hidden" name="newValue" value="true"></input>
        	<input type="hidden" name="user_id" value="<%=user_id%>"></input>
        	<input type="hidden" name="person_id" value="<%=user_id%>"></input>
        	<tr align="center"><%=byEmail.toString()%></tr>
        	<tr align="center"><%=byPhone.toString()%></tr>
        	<tr align="center"><%=byFax.toString()%></tr>
        	<tr align="center"><%=byMobile.toString()%></tr>
        	<tr align="center"><%=byVoiceMail.toString()%></tr>
        	<tr align="center"><%=byTextMessage.toString()%></tr>
        	
            </table>
            <br/>
            <input type="button" value ="Close" onclick="$('#profileDetails<%=profile_id%>').html('')"></input>
     		<input type="submit" class="button" value="Save" ></input>
			<br/>
            </center>
          
			
    <%
    }
    rs.close();
    conn.close();
%>