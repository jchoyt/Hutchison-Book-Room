<%@ tag import="java.io.*,java.util.*,org.mitre.mrald.taglib.*,org.mitre.mrald.util.*,java.sql.*" %>
<%
 	String team_id = WebUtils.getOptionalParameter(request, "team_id", "1" ); 
    int teamId = Integer.parseInt(team_id);
   
	StringBuffer userList = new StringBuffer("");
	String button =  "<td><input type=\"button\" onclick=\"replace('"+ team_id +"')\" value=\"Add\"></input></td>";
    String user = WebUtils.getOptionalParameter(request, "user", "ghamilton" );
    String team_name = WebUtils.getOptionalParameter(request, "team_name", "" );
      
    String query = 
    "select  user_name, first_name, last_name  from saife_user " ;
    
    Connection conn = new MraldConnection("main").getConnection();
    PreparedStatement prep = conn.prepareStatement(query);
	
    StringBuffer logInfo = new StringBuffer();
    long startTime = MiscUtils.logQuery("displayUserTeams.tag", "main", query, logInfo);
    ResultSet rs =prep.executeQuery();
    
    while (rs.next())
    {
        String name = rs.getString("user_name");
        String first_name = rs.getString("first_name");
        String last_name = rs.getString("last_name");
        
    	%>
    	 
        	
       <% 	
        String user_name = rs.getString("user_name");
        userList.append("<option value=\""+  user_name +  "\">" + first_name + " " + last_name + "</option>");
    }
    userList.append("\n");
      
     
    team_name ="";
    query = 
	    "select user_name, first_name, last_name, team_name from saife_team s, team_user t, saife_user u " 
	    + " where s.team_id = t.saife_team_team_id " 
	    + " and saife_user_user_id = u.user_id and "
		+"  s.team_id = ? order by team_name ";
    
    conn = new MraldConnection("main").getConnection();
    prep = conn.prepareStatement(query);
	prep.setInt(1, teamId);
     logInfo = new StringBuffer();
    startTime = MiscUtils.logQuery("editUserTeam.tag", "main", query, logInfo);
    rs =prep.executeQuery();
    
    MiscUtils.logQueryRun(startTime, logInfo);
    
    
    %>
    		<div class="results">
    		<table>
    		<tr><td colspan="2">User List</td></tr>
    		<tr><td><select name="selectUser"><%=userList%></select></td><%=button%></tr>
        	</table>
        	
        	<div id="listUsers<%=team_id%>">
        	<table><tr><td>Team Members</td></tr>
    <%	
    int i=0;	
    while (rs.next())
    {
        String name = rs.getString("user_name");
        String first_name = rs.getString("first_name");
        String last_name = rs.getString("last_name");	
        String user_name = rs.getString("user_name");
        team_name = rs.getString("team_name");
        %>
        
        <tr><td><input id="users<%=i%>" type="text" name="users" value="<%=user_name%>" />
		<input type="button" onclick="remove('<%=user_name%>','<%=team_id%>')" value="Remove"></input></td></tr>              
           
        <%
        i++;
    }
      userList.append("\n");
    %>
    		
    </table></div>
    </div>
	
<%
    rs.close();
    conn.close();
%>